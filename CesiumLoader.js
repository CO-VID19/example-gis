"use strict";function _defineProperty(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function BDImageryProvider(e){this._url="https://api.map.baidu.com/customimage/tile?udt=20181205&scale=1&ak=1XjLLEhZhQNUzd93EjU5nOGQ&customid=white",this._tileWidth=256,this._tileHeight=256,this._maximumLevel=18,this._height=33746824,this._width=33554054;var i=new Cesium.Cartesian2(-this._width,-this._height),t=new Cesium.Cartesian2(this._width,this._height);this._tilingScheme=new Cesium.WebMercatorTilingScheme({rectangleSouthwestInMeters:i,rectangleNortheastInMeters:t}),this._credit=void 0,this._rectangle=this._tilingScheme.rectangle,this._ready=!0}function buildImageUrl(e,i,t,r){var a=e._url+"&x={x}&y={y}&z={z}",n=e._tilingScheme.getNumberOfXTilesAtLevel(r),s=e._tilingScheme.getNumberOfYTilesAtLevel(r);return a=a.replace("{x}",i-n/2).replace("{y}",s/2-t-1).replace("{z}",r)}function createAMapByUrl(e,i){i=e.defaultValue(i,{});var t=e.defaultValue(i.url,"//webst01.is.autonavi.com/appmaptile?style=6&x={x}&y={y}&z={z}"),r=new e.Credit("AMap"),a=new e.WebMercatorTilingScheme({ellipsoid:i.ellipsoid}),n=e.defaultValue(i.minimumLevel,0),s=e.defaultValue(i.minimumLevel,18),o=e.defaultValue(i.rectangle,a.rectangle),l=a.positionToTileXY(e.Rectangle.southwest(o),n),u=a.positionToTileXY(e.Rectangle.northeast(o),n),c=(Math.abs(u.x-l.x)+1)*(Math.abs(u.y-l.y)+1);if(c>4)throw new e.DeveloperError("The rectangle and minimumLevel indicate that there are "+c+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");var m=e.defaultValue(i.credit,r);return"string"==typeof m&&(m=new e.Credit(m)),new e.UrlTemplateImageryProvider({url:t,proxy:i.proxy,credit:m,tilingScheme:a,tileWidth:256,tileHeight:256,minimumLevel:n,maximumLevel:s,rectangle:o})}var _createClass=function(){function e(e,i){for(var t=0;t<i.length;t++){var r=i[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(i,t,r){return t&&e(i.prototype,t),r&&e(i,r),i}}(),CLOUD=CLOUD||{};Cesium.defineProperties(BDImageryProvider.prototype,{url:{get:function(){return this._url}},token:{get:function(){return this._token}},proxy:{get:function(){return this._proxy}},tileWidth:{get:function(){if(!this._ready)throw new DeveloperError("tileWidth must not be called before the imagery provider is ready.");return this._tileWidth}},tileHeight:{get:function(){if(!this._ready)throw new DeveloperError("tileHeight must not be called before the imagery provider is ready.");return this._tileHeight}},maximumLevel:{get:function(){if(!this._ready)throw new DeveloperError("maximumLevel must not be called before the imagery provider is ready.");return this._maximumLevel}},minimumLevel:{get:function(){if(!this._ready)throw new DeveloperError("minimumLevel must not be called before the imagery provider is ready.");return 0}},tilingScheme:{get:function(){if(!this._ready)throw new DeveloperError("tilingScheme must not be called before the imagery provider is ready.");return this._tilingScheme}},rectangle:{get:function(){if(!this._ready)throw new DeveloperError("rectangle must not be called before the imagery provider is ready.");return this._rectangle}},tileDiscardPolicy:{get:function(){if(!this._ready)throw new DeveloperError("tileDiscardPolicy must not be called before the imagery provider is ready.");return this._tileDiscardPolicy}},errorEvent:{get:function(){return this._errorEvent}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},credit:{get:function(){return this._credit}},usingPrecachedTiles:{get:function(){return this._useTiles}},hasAlphaChannel:{get:function(){return!0}},layers:{get:function(){return this._layers}}}),BDImageryProvider.prototype.getTileCredits=function(e,i,t){},BDImageryProvider.prototype.requestImage=function(e,i,t){if(!this._ready)throw new DeveloperError("requestImage must not be called before the imagery provider is ready.");var r=buildImageUrl(this,e,i,t);return Cesium.ImageryProvider.loadImage(this,r)};var fixGltf=function(e){if(e.extensionsUsed){var i=e.extensionsUsed.indexOf("KHR_technique_webgl"),t=e.extensionsRequired.indexOf("KHR_technique_webgl");if(-1!==i){e.extensionsRequired.splice(t,1,"KHR_techniques_webgl"),e.extensionsUsed.splice(i,1,"KHR_techniques_webgl"),e.extensions=e.extensions||{},e.extensions.KHR_techniques_webgl={},e.extensions.KHR_techniques_webgl.programs=e.programs,e.extensions.KHR_techniques_webgl.shaders=e.shaders,e.extensions.KHR_techniques_webgl.techniques=e.techniques;var r=e.extensions.KHR_techniques_webgl.techniques;e.materials.forEach(function(i,t){e.materials[t].extensions||(e.materials[t].extensions={KHR_technique_webgl:{}}),e.materials[t].extensions.KHR_technique_webgl.values=e.materials[t].values,e.materials[t].extensions.KHR_techniques_webgl=e.materials[t].extensions.KHR_technique_webgl;var a=e.materials[t].extensions.KHR_techniques_webgl;a.technique||(a.technique=e.materials[t].technique);for(var n in a.values){var s=r[a.technique].uniforms;for(var o in s)if(s[o]===n){a.values[o]=a.values[n],delete a.values[n];break}}}),r.forEach(function(e){for(var i in e.attributes){var t=e.attributes[i];e.attributes[i]=e.parameters[t]}for(var r in e.uniforms){var t=e.uniforms[r];e.uniforms[r]=e.parameters[t]}})}}};Object.defineProperties(Cesium.Model.prototype,{_cachedGltf:{set:function(e){this._vtxf_cachedGltf=e,this._vtxf_cachedGltf&&this._vtxf_cachedGltf._gltf&&fixGltf(this._vtxf_cachedGltf._gltf)},get:function(){return this._vtxf_cachedGltf}}});var CesiumLoader=function(){function e(i){_classCallCheck(this,e),this.container=i.container,this.worldCoordinates=[0,0],this.worldCoordinates[0]=void 0==i.longitude?121.32403:i.longitude,this.worldCoordinates[1]=void 0==i.latitude?31.198192:i.latitude,this.useTerrain=void 0!=i.useTerrain&&i.useTerrain,this.imageryLayer=void 0==i.imageryLayer?CLOUD.EnumCesiumImageryLayerType.AUTO:i.imageryLayer,this.clipHeight=void 0==i.clipHeight?0:i.clipHeight,this.duration=void 0==i.duration?5:i.duration,this.accessToken=i.accessToken,this.globalPlane=void 0,this.viewer=void 0,this.terrainProvider=void 0,this.terrainHeight={},this.globeMatrix=void 0,this.cameraScale=.001,this.viewport=void 0,this.originBimCameraTar=void 0,this.closeToModel=0}return _createClass(e,[{key:"init",value:function(e,i){var t=this;this.accessToken&&(Cesium.Ion.defaultAccessToken=this.accessToken),this.terrainProvider=Cesium.createWorldTerrain();var r=[Cesium.Cartographic.fromDegrees(this.worldCoordinates[0],this.worldCoordinates[1])],a=Cesium.sampleTerrainMostDetailed(this.terrainProvider,r),n=void 0;switch(t.imageryLayer){case CLOUD.EnumCesiumImageryLayerType.AUTO:n=void 0==t.accessToken&&new Cesium.TileMapServiceImageryProvider({url:Cesium.buildModuleUrl("Assets/Textures/NaturalEarthII")});break;case CLOUD.EnumCesiumImageryLayerType.BAIDU:n=new BDImageryProvider;break;case CLOUD.EnumCesiumImageryLayerType.GAODE:var s=createAMapByUrl(Cesium,{url:"//webst01.is.autonavi.com/appmaptile?style=7&x={x}&y={y}&z={z}"});createAMapByUrl(Cesium,{url:"//wprd04.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=11"}),createAMapByUrl(Cesium,{url:"//wprd04.is.autonavi.com/appmaptile?x={x}&y={y}&z={z}&lang=zh_cn&size=1&scl=1&style=8&ltype=12"});n=s;break;case CLOUD.EnumCesiumImageryLayerType.MAPBOX:n=new Cesium.MapboxImageryProvider({mapId:"mapbox.streets-satellite"});break;case CLOUD.EnumCesiumImageryLayerType.GOOGLE:n=t.createGoogleMapsByUrl(Cesium,{url:"https://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}"});break;case CLOUD.EnumCesiumImageryLayerType.ARCGIS:n=new Cesium.ArcGisMapServerImageryProvider({url:"https://nationalmap.gov.au/proxy/http://services.ga.gov.au/site_3/rest/services/Electricity_Infrastructure/MapServer"});break;default:n=t.createGoogleMapsByUrl(Cesium,{url:"https://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}"})}Cesium.when(a,function(r){var a;t.viewer=new Cesium.Viewer(t.container,(a={useDefaultRenderLoop:!0,selectionIndicator:!1,homeButton:!1,sceneModePicker:!1,navigationHelpButton:!1,infoBox:!1},_defineProperty(a,"navigationHelpButton",!1),_defineProperty(a,"navigationInstructionsInitiallyVisible",!1),_defineProperty(a,"animation",!1),_defineProperty(a,"timeline",!1),_defineProperty(a,"fullscreenButton",!1),_defineProperty(a,"allowTextureFilterAnisotropic",!1),_defineProperty(a,"contextOptions",{webgl:{alpha:!0,antialias:!0,preserveDrawingBuffer:!0,failIfMajorPerformanceCaveat:!1,depth:!0,stencil:!1,anialias:!0}}),_defineProperty(a,"targetFrameRate",60),_defineProperty(a,"resolutionScale",.1),_defineProperty(a,"orderIndependentTranslucency",!0),_defineProperty(a,"imageryProvider",n),_defineProperty(a,"baseLayerPicker",!1),_defineProperty(a,"geocoder",!1),_defineProperty(a,"automaticallyTrackDataSourceClocks",!1),_defineProperty(a,"dataSources",null),_defineProperty(a,"clock",null),_defineProperty(a,"terrainShadows",Cesium.ShadowMode.DISABLED),a)),t.terrainHeight=0,!0===t.useTerrain&&(t.terrainHeight=r[0].height,t.viewer.terrainProvider=Cesium.createWorldTerrain()),t.viewer._cesiumWidget._creditContainer.style.display="none",t.viewer.scene.skyBox.show=!1,t.viewer.scene.backgroundColor=new Cesium.Color(0,0,0,0),t.updateCesiumOriginPos(),new Cesium.ScreenSpaceEventHandler(t.viewer.scene.canvas).setInputAction(function(e){var i=t.viewer.scene.pickPosition(e.position);console.log(i),i=t.kadierTollh(i),console.log(i)},Cesium.ScreenSpaceEventType.LEFT_CLICK),t.viewer.camera.flyTo({destination:t.cesiumOriginPos,orientation:{heading:Cesium.Math.toRadians(175),pitch:Cesium.Math.toRadians(-35),roll:0},duration:t.duration,complete:function(){e&&e(i)}}),this.viewer.scene.globe.depthTestAgainstTerrain=!0})}},{key:"createGoogleMapsByUrl",value:function(e,i){i=e.defaultValue(i,{});var t=e.defaultValue(i.url,"https://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}"),r=new e.Credit("Google Maps"),a=new e.WebMercatorTilingScheme({ellipsoid:i.ellipsoid}),n=e.defaultValue(i.minimumLevel,0),s=e.defaultValue(i.minimumLevel,17),o=e.defaultValue(i.rectangle,a.rectangle),l=a.positionToTileXY(e.Rectangle.southwest(o),n),u=a.positionToTileXY(e.Rectangle.northeast(o),n),c=(Math.abs(u.x-l.x)+1)*(Math.abs(u.y-l.y)+1);if(c>4)throw new e.DeveloperError("The rectangle and minimumLevel indicate that there are "+c+" tiles at the minimum level. Imagery providers with more than four tiles at the minimum level are not supported.");var m=e.defaultValue(i.credit,r);return"string"==typeof m&&(m=new e.Credit(m)),new e.UrlTemplateImageryProvider({url:t,proxy:i.proxy,credit:m,tilingScheme:a,tileWidth:256,tileHeight:256,minimumLevel:n,maximumLevel:s,rectangle:o})}},{key:"updateCesiumOriginPos",value:function(){this.cesiumOriginPos=Cesium.Cartesian3.fromDegrees(this.worldCoordinates[0],this.worldCoordinates[1],this.terrainHeight+100)}},{key:"kadierTollh",value:function(e){if(Cesium.defined(e)){var i=Cesium.Cartographic.fromCartesian(e);return{lon:Cesium.Math.toDegrees(i.longitude),lat:Cesium.Math.toDegrees(i.latitude),alt:i.height}}}},{key:"llhToKadier",value:function(e,i,t){return Cesium.Cartesian3.fromDegrees(e,i,t)}},{key:"loadGltf",value:function(e,i,t,r){var a=new Cesium.Matrix3(.7722797,.6352827,-2.980228e-8,-2.494678e-8,7.723833e-8,1,.6352827,-.7722797,7.549784e-8),n=Cesium.Matrix4.fromRotationTranslation(a,Cesium.Cartesian3.fromDegrees(e,i,t+100),void 0);this.viewer.scene.primitives.add(Cesium.Model.fromGltf({url:r,modelMatrix:n,scale:200})).readyPromise.then(function(e){console.log("load gltf successfully")}).otherwise(function(e){window.alert(e)})}},{key:"loadSkyBox",value:function(){this.viewer.scene.skyBox=new Cesium.SkyBox({sources:{positiveX:"../cesium/ThirdParty/Cesium/Apps/SampleData/px.jpg",negativeX:"../cesium/ThirdParty/Cesium/Apps/SampleData/nx.jpg",positiveY:"../cesium/ThirdParty/Cesium/Apps/SampleData/py.jpg",negativeY:"../cesium/ThirdParty/Cesium/Apps/SampleData/ny.jpg",positiveZ:"../cesium/ThirdParty/Cesium/Apps/SampleData/pz.jpg",negativeZ:"../cesium/ThirdParty/Cesium/Apps/SampleData/nz.jpg"}})}},{key:"loadGeoJson",value:function(e){Cesium.GeoJsonDataSource.load(e).then(function(e){self.viewer.dataSources.add(e),e.entities.values}).otherwise(function(e){window.alert(e)})}}]),e}();CLOUD.CesiumLoader=CesiumLoader;